---
const { 
  url = "https://example.com",
  height = "auto",
  scale = 0.75,
  showLock = true
} = Astro.props;

// Import the external script
import '../components/browserWindowScript.js';
---

<style>
  :root {
    --mac-red: #ff5f57;
    --mac-yellow: #ffbd2e;
    --mac-green: #28c940;
  }

  .browser-container {
    width: 100%;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
    background: #fff;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    display: flex;
    flex-direction: column;
    height: var(--container-height, auto);
    isolation: isolate; /* Establish new stacking context */
  }

  .browser-header {
    background: linear-gradient(to bottom, #fdfdfd, #e5e5e5);
    height: 40px;
    padding: 0 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 1px solid #c0c0c0;
    flex-shrink: 0;
  }

  .browser-controls {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .control-circle {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 0.5px solid rgba(0,0,0,0.15);
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.15);
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .control-circle.red    { background: var(--mac-red); }
  .control-circle.yellow { background: var(--mac-yellow); }
  .control-circle.green  { background: var(--mac-green); }

  .control-circle:hover {
    transform: scale(1.1);
  }

  .browser-url-bar {
    flex: 1;
    background: #fff;
    border: 1px solid #bbb;
    border-radius: 8px;
    height: 26px;
    padding: 0 12px;
    font-size: 13px;
    color: #333;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    user-select: none;
  }

  .lock-icon {
    width: 12px;
    height: 12px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 14'%3E%3Cpath fill='%23666' d='M10.5 5h-.75V3.5A3.25 3.25 0 006.5 0a3.25 3.25 0 00-3.25 3.25V5h-.75A1.5 1.5 0 001 6.5v6a1.5 1.5 0 001.5 1.5h8a1.5 1.5 0 001.5-1.5v-6A1.5 1.5 0 0010.5 5zM4.5 5V3.5a2 2 0 114 0V5h-4z'/%3E%3C/svg%3E") no-repeat center;
    opacity: 0.7;
  }

  .content-scaler {
    flex: 1;
    min-height: 250px;
    transform: scale(var(--scale));
    transform-origin: top left;
    width: calc(100% / var(--scale));
    background: #fafafa;
    position: relative;
    overflow: hidden;
    isolation: isolate; /* Create new stacking context to contain elements */
  }

  .content-scaler::before {
    content: "";
    position: absolute;
    inset: 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    pointer-events: none;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
  }
</style>

<div class="browser-container" style={`--container-height: ${height}; --scale: ${scale};`}>
  <div class="browser-header">
    <div class="browser-controls">
      <button class="control-circle red" 
              title="Close" 
              onclick="this.closest('.browser-container').style.display = 'none'">
      </button>
      <button class="control-circle yellow" 
              title="Minimize" 
              onclick="this.closest('.browser-container').style.transform = 'scale(0.9)'; this.closest('.browser-container').style.opacity = '0.7';">
      </button>
      <button class="control-circle green" 
              title="Fullscreen" 
              onclick="fullScreenToggle(this)">
      </button>
    </div>
    <div class="browser-url-bar">
      {showLock && <div class="lock-icon"></div>}
      <span>{url}</span>
    </div>
  </div>
  <div class="content-scaler">
    <slot />
  </div>
</div>